---

- include: "deps.yml"
  static: no
  tags:
    - "atom-deps"
  when:
    - ansible_distribution == "Ubuntu"

- include: "deps-rh.yml"
  static: no
  tags:
    - "atom-deps"
  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"
    

- include: "php.yml"
  static: no
  tags:
    - "atom-php"
  when:
    - ansible_distribution == "Ubuntu"

- include: "php-rh.yml"
  static: no
  tags:
    - "atom-php"
  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"


- include: "basic.yml"
  tags:
    - "atom-basic"

- include: "flush.yml"
  become_user: "{{ atom_user }}"
  when: "atom_flush_data is defined and atom_flush_data|bool"
  tags:
    - "atom-flush"

- include: "plugins.yml"
  become_user: "{{ atom_user }}"
  tags:
    - "atom-plugins"

- include: "search.yml"
  become_user: "{{ atom_user }}"
  when: "atom_populate_index is defined and atom_populate_index|bool"
  tags:
    - "atom-search"

# do not build as user www-data due to errors with npm
- include: "build.yml"
  when: "atom_build_static_assets is defined and atom_build_static_assets|bool"
  tags:
    - "atom-build"

- include: "worker.yml"
  static: no
  tags:
    - "atom-worker"
  when: 
    - atom_worker_setup is defined and atom_worker_setup|bool
    - ansible_distribution == "Ubuntu"

- include: "worker-rh.yml"
  static: no
  tags:
    - "atom-worker"
  when: 
    - atom_worker_setup is defined and atom_worker_setup|bool
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"

- include: "devbox.yml"
  when: "atom_devbox|bool"
  tags:
    - "atom-devbox"
