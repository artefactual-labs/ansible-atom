---

- name: "Add external repository keys"
  apt_key:
    url: "{{ item }}"
    state: "present"
  with_items:
    - "https://deb.nodesource.com/gpgkey/nodesource.gpg.key"

- name: "Add external repositories"
  apt_repository:
    repo: "{{ item }}"
    update_cache: "yes"
  with_items:
    - "deb https://deb.nodesource.com/node_5.x {{ ansible_distribution_release }} main"

- name: "Add archivematica/externals-dev PPA (ffmpeg in Ubuntu <= 14.04)"
  apt_repository:
    repo: "ppa:archivematica/externals-dev"
    update_cache: "yes"
  when: "ansible_distribution_version | version_compare('14.04', '<=')"

- name: "Install AtoM dependencies"
  apt:
    pkg: "{{ item }}"
    state: "latest"
  with_items:
    - "imagemagick"       # ↓ AtoM dependencies
    - "ghostscript"       #
    - "poppler-utils"     #
    - "ffmpeg"            #
    - "git"               # ↓ Build dependencies
    - "nodejs"            #
    - "make"              #
    - "python-pip"        #
    - "python-setuptools" #

- name: "Install Sphinx"
  pip:
    name: "{{ item }}"
    state: "latest"
  with_items:
    - "sphinx"
    - "sphinxcontrib-httpdomain"

- name: "Install npm global dependencies (also required during the build)"
  npm:
    name: "{{ item }}"
    global: "yes"
  with_items:
    - "grunt-cli"
    - "less@<2.0.0"
